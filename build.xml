<?xml version="1.0"?>

<project name="agavi" basedir="." default="main">

	<!-- set up some stuff -->
  <property environment="env"/>
  <property file="build.properties"/>
  <property name="package"  value="${phing.project.name}" override="true" />
  <property name="builddir" value="build" override="true" />
  <property name="srcdir"   value="${project.basedir}" override="true" />
	<taskdef classname="etc.phing.AgaviPackageTask" name="agavipackage"/>
	<taskdef classname="src.buildtools.phing.AgaviTestTask" name="agavitest"/>

  <!-- fileset for -dist files -->
  <fileset dir="." id="distfiles">
		<include name="**/*-dist"/>
  </fileset>

  <!-- main target -->
	<target name="main" description="main target">
		<echo msg="available targets: " /> 
		<echo msg="  docs    : regenerate phpdocs   " />
		<echo msg="  test    : run unit test suite  " />
		<echo msg="  package : generate PEAR package" />
		<echo msg="  clean   : clean out cruft      " />
	</target>

	<target name="docs" description="docs target">
		<phpdoc title="Agavi Documentation" destdir="apidocs" sourcepath="src" output="HTML:frames:earthli"/>
	</target>

	<target name="package" description="build pear package">
		<agavipackage dir="build"/>
	</target>

	<target name="test" description="run test suite">
		<agavitest exit="true"/>
	</target>

	<target name="clean" description="clean out the cruft">
		<delete dir="build" includeemptydirs="true" failonerror="true" />
		<delete dir="apidocs" includeemptydirs="true" quiet="true" failonerror="false" />
		<delete file="tests.html" includeemptydirs="true" quiet="true" failonerror="false" />
	</target>

	<target name="damagecontrol" description="damagecontrol target">
		<phingcall target="docs"/>
		<phingcall target="package"/>
		<agavitest exit="true" outfile="tests.html" reporter="html"/>
		<!-- sync docs, packages, tests.html -->
	</target>

</project>
